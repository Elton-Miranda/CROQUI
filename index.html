<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CROQUI System v21</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><path d=%22M50 10 L20 80 M50 10 L80 80%22 stroke=%22%23660099%22 stroke-width=%228%22 stroke-linecap=%22round%22/><circle cx=%2250%22 cy=%2210%22 r=%226%22 fill=%22%2300ffff%22/><path d=%22M20 85 Q50 100 80 85%22 stroke=%22%2300ffff%22 stroke-width=%224%22 stroke-dasharray=%2210 5%22 fill=%22none%22/></svg>">
    
    <link rel="stylesheet" href="css/style.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>

<div id="modalAjuda" class="modal">
    <div class="modal-content manual-content">
        <span class="close" onclick="fecharModais()">&times;</span>
        <h2 class="manual-title">ğŸ“– Manual do UsuÃ¡rio</h2>
        
        <div class="manual-scroll">
            <div class="manual-section">
                <h3>1. Montando o CenÃ¡rio (Arrastar)</h3>
                <p>Para colocar Postes, Caixas ou CTOPs:</p>
                <ul>
                    <li>Clique no botÃ£o do item na barra lateral esquerda.</li>
                    <li>Segure o clique e <b>arraste</b> atÃ© a posiÃ§Ã£o desejada na folha branca.</li>
                    <li>Solte para fixar.</li>
                </ul>
            </div>

            <div class="manual-section">
                <h3>2. Passando Cabos (ÃmÃ£)</h3>
                <p>O sistema ajuda a desenhar reto:</p>
                <ul>
                    <li>Escolha <b>Instalar</b> (Vermelho), <b>Retirar</b> (Verde) ou <b>Cordoalha</b> (Azul).</li>
                    <li>Clique no meio de um poste (o mouse Ã© atraÃ­do para o centro).</li>
                    <li>Arraste atÃ© o prÃ³ximo poste e solte.</li>
                </ul>
                <p class="nota-dica">ğŸ’¡ <b>Dica:</b> Para parar de desenhar ou cancelar, clique no botÃ£o cinza <b>âœ‹ Parar (ESC)</b>.</p>
            </div>

            <div class="manual-section">
                <h3>3. O Segredo das Notas (Excel)</h3>
                <p>O botÃ£o <b>ğŸ“ Nota</b> cria um post-it inteligente:</p>
                <ul>
                    <li>Se digitar sÃ³ texto (ex: <i>"Poste quebrado"</i>), sai como observaÃ§Ã£o.</li>
                    <li><b>IMPORTANTE:</b> Se digitar Quantidade + Nome (ex: <code>12 FusÃµes</code> ou <code>2 AlÃ§as</code>), o sistema conta isso na planilha de materiais!</li>
                </ul>
            </div>

            <div class="manual-section">
                <h3>4. Finalizando</h3>
                <p>Ao clicar em <b>ğŸ’¾ SALVAR TUDO</b>, preencha:</p>
                <ul>
                    <li><b>Seus Dados:</b> Nome e RE.</li>
                    <li><b>O Projeto:</b> AT (ex: SJ), Cabo (ex: 5) e PrimÃ¡ria (ex: 1).</li>
                </ul>
                <p>O sistema formata os zeros (05, 01) e gera a imagem e o Excel automaticamente.</p>
            </div>

            <div class="manual-footer">
                <p>âŒ¨ï¸ <b>Atalhos:</b> <code>DELETE</code> apaga item | <code>ESC</code> cancela ferramenta.</p>
            </div>
        </div>
        
        <button class="btn-salvar" style="width: 100%; margin-top: 15px;" onclick="fecharModais()">LI E ENTENDI, VAMOS LÃ!</button>
    </div>
</div>

<div id="modalSalvar" class="modal">
    <div class="modal-content" style="max-width: 400px;">
        <span class="close" onclick="fecharModais()">&times;</span>
        <h2 class="modal-title" style="border-bottom: 2px solid #660099; color: #660099;">Finalizar Croqui</h2>
        
        <label class="form-label" style="color: #d35400;">NÃºmero da OcorrÃªncia (Opcional)</label>
        <input type="text" id="inputOcorrencia" placeholder="Deixe vazio para 'Levantamento de Obra'" style="border: 1px solid #d35400; background: #fffdf0;">

        <div style="background: #f0f4f8; padding: 15px; border-radius: 8px; margin: 15px 0; border: 1px solid #d9e2ec;">
            <label class="form-label">Nome</label> <input type="text" id="inputNome" placeholder="Seu Nome">
            <label class="form-label">Sobrenome</label> <input type="text" id="inputSobrenome" placeholder="Seu Sobrenome">
            <label class="form-label">RE (Registro)</label> <input type="text" id="inputRE" placeholder="Ex: 123456">
        </div>
        <label class="form-label">AT (2 Letras)</label> <input type="text" id="inputAT" placeholder="Ex: SJ" maxlength="2" style="text-transform: uppercase;">
        <div style="display: flex; gap: 10px;">
            <div style="flex:1"><label class="form-label">Cabo</label><input type="number" id="inputCabo" placeholder="Ex: 5" max="99"></div>
            <div style="flex:1"><label class="form-label">PrimÃ¡ria</label><input type="number" id="inputPrimaria" placeholder="Ex: 1" max="144"></div>
        </div>
        <button class="btn-salvar" style="width: 100%; margin-top: 20px;" onclick="confirmarSalvar()">GERAR ARQUIVOS</button>
    </div>
</div>

<div class="container">
    <div class="sidebar">
        
        <div class="app-header">
            <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 5px;">
                <svg width="40" height="40" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M50 10 L20 80 M50 10 L80 80" stroke="#fff" stroke-width="8" stroke-linecap="round"/>
                    <circle cx="50" cy="10" r="6" fill="#00ffff"/>
                    <path d="M20 85 Q50 100 80 85" stroke="#00ffff" stroke-width="4" stroke-dasharray="10 5"/>
                </svg>
                <div style="text-align: left;">
                    <h2 style="margin:0; line-height: 1;">CROQUI</h2>
                    <span style="font-size: 9px; letter-spacing: 1px;">PRO SYSTEM</span>
                </div>
            </div>
            <button class="btn-help-header" onclick="abrirAjuda()">ğŸ“˜ MANUAL</button>
        </div>

        <div class="tool-group">
            <h3>ğŸ”Œ Desenho de Cabos</h3>
            <div style="display: flex; gap: 4px;">
                <button id="btnInstall" class="btn-cabo-novo" onclick="ativarModoLinha('instalar')">Instalar</button>
                <button id="btnRet" class="btn-cabo-ret" onclick="ativarModoLinha('retirar')">Retirar</button>
            </div>
            <button id="btnExist" class="btn-cabo-exist" onclick="ativarModoLinha('existente')">Existente</button>
            <button id="btnCord" class="btn-cordoalha" onclick="ativarModoLinha('cordoalha')">Cordoalha (Guia)</button>
            <button id="btnPare" class="btn-parar" onclick="resetFerramentas()">âœ‹ Parar (ESC)</button>
        </div>

        <div class="tool-group">
            <h3>ğŸ—ï¸ Infraestrutura (Arraste)</h3>
            <button draggable="true" ondragstart="drag(event, 'posteXC')" class="btn-infra"><span class="icon">I</span>Poste Concreto</button>
            <button draggable="true" ondragstart="drag(event, 'posteXM')" class="btn-infra"><span class="icon">I</span>Poste Madeira</button>
            <button draggable="true" ondragstart="drag(event, 'subidaLateral')" class="btn-infra" style="border-left: 3px solid #e74c3c;"><span class="icon">ğŸ“ˆ</span>Subida Lateral</button>
        </div>

        <div class="tool-group">
            <h3>ğŸ“¦ Caixas e CS (Arraste)</h3>
            <div style="display: flex; gap: 4px;">
                <button draggable="true" ondragstart="drag(event, 'ceoExist')" class="btn-cx-exist">âš« Exist.</button>
                <button draggable="true" ondragstart="drag(event, 'ceoNova')" class="btn-cx-nova">âšª Nova</button>
            </div>
            <button draggable="true" ondragstart="drag(event, 'cs')" class="btn-cs"><span class="icon">â¬›</span>Caixa Subt. (CS)</button>
        </div>

        <div class="tool-group">
            <h3>ğŸ¨ CTOP (Arraste)</h3>
            <div class="ctop-grid">
                <button draggable="true" ondragstart="drag(event, 'ctop-EE82EE-01:08')" class="ctop-btn" style="background:#EE82EE;">01:08</button>
                <button draggable="true" ondragstart="drag(event, 'ctop-FF0000-09:16')" class="ctop-btn" style="background:#FF0000; color:white;">09:16</button>
                <button draggable="true" ondragstart="drag(event, 'ctop-0000FF-17:24')" class="ctop-btn" style="background:#0000FF; color:white;">17:24</button>
                <button draggable="true" ondragstart="drag(event, 'ctop-FFFFFF-25:32')" class="ctop-btn" style="background:#FFFFFF;">25:32</button>
                <button draggable="true" ondragstart="drag(event, 'ctop-FFFF00-33:40')" class="ctop-btn" style="background:#FFFF00;">33:40</button>
                <button draggable="true" ondragstart="drag(event, 'ctop-008000-41:48')" class="ctop-btn" style="background:#008000; color:white;">41:48</button>
                <button draggable="true" ondragstart="drag(event, 'ctop-008000-49:56')" class="ctop-btn" style="background:#008000; color:white;">49:56</button>
                <button draggable="true" ondragstart="drag(event, 'ctop-008000-57:64')" class="ctop-btn" style="background:#008000; color:white;">57:64</button>
            </div>
        </div>

        <div class="tool-group">
            <h3>ğŸ“ IdentificaÃ§Ã£o / Notas</h3>
            <div class="btn-row">
                <button class="btn-action" onclick="addNomeRua()">ğŸ…°ï¸ Rua</button>
                <button class="btn-action" onclick="addObservacao()">ğŸ“ Nota</button>
                <button id="btnArrow" class="btn-seta" onclick="ativarModoLinha('seta')">â†—ï¸ Seta</button>
            </div>
        </div>

        <div class="tool-group">
            <h3>ğŸ“ MediÃ§Ãµes</h3>
            <div style="display: flex; gap: 4px;">
                <button class="btn-medida" onclick="addMedida('instalado')">Instalado</button>
                <button class="btn-medida" onclick="addMedida('retirado')" style="border-color:#27ae60; color:#27ae60;">Retirado</button>
            </div>
            <button class="btn-medida" onclick="addMedida('cordoalha')" style="border-color:#2980b9; color:#2980b9;">Cordoalha</button>
        </div>

        <div class="tool-group">
            <h3>ğŸ·ï¸ Tipo de Cabo</h3>
            <div style="display: flex; gap: 4px; flex-wrap: wrap;">
                <select id="tipoCabo" onchange="atualizarBitolas()" style="width: 100%;"><option>CFOA SM AS</option><option>DROP</option></select>
                <select id="bitolaCabo" style="flex: 1;"></select>
                <button onclick="addEtiquetaCabo()" class="btn-action" style="background: #ecf0f1; width: auto; flex: 1;">Inserir</button>
            </div>
        </div>

        <div style="margin-top: auto; padding-top: 10px;">
             <button class="btn-action" onclick="deleteSelected()" style="background-color: #c0392b; color: white;">ğŸ—‘ï¸ Apagar SeleÃ§Ã£o</button>
             <button class="btn-action" onclick="novoCroqui()" style="background-color: #3498db; color: white;">ğŸ“„ NOVO CROQUI</button>
             <button class="btn-salvar" onclick="abrirModalSalvar()">ğŸ’¾ SALVAR TUDO</button>
        </div>
    </div>

    <div class="canvas-area" id="dropZone">
        <div class="canvas-wrapper">
            <canvas id="c" width="1100" height="700"></canvas>
        </div>
    </div>
</div>

<script src="js/app.js"></script>
</body>
</html>